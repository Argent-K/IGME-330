(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var t,n,r,o,a,i,c,l=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")},u=Object.freeze({gain:.5,numSamples:256}),s=(new Uint8Array(u.numSamples/2),function(e){o.src=e});function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===h(o)?o:String(o)),r)}var o}function m(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var g,v,b,p,w,S,q,T=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white",a=arguments.length>4?arguments[4]:void 0;d(this,e),this.x=t,this.y=n,this.radius=r,this.color=o,this.duration=a}return m(e,[{key:"draw",value:function(e){e.save(),e.beginPath(),e.fillStyle="rgba(".concat(255*Math.sin(this.x),",").concat(255*Math.cos(this.x),",").concat(255*Math.tan(this.x),",1)"),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}},{key:"update",value:function(){"suspended"!=t.state&&(this.x=v*((t.currentTime+1)/this.duration))}}]),e}(),A=function(){function e(t,n,r,o){d(this,e),this.n=0,this.centerX=t,this.centerY=n,this.divergence=r,this.c=o}return m(e,[{key:"update",value:function(){"suspended"!=t.state&&this.n++,t.currentTime%10==0&&(this.n=0)}},{key:"draw",value:function(e){var n=this.n*this.dtr(this.divergence),r=this.c*Math.sqrt(this.n),o=r*Math.cos(n)+this.centerX,a=r*Math.sin(n)+this.centerY,i="hsl(".concat(t.currentTime%361,",100%,50%)");this.drawCircle(e,o,a,2,i)}},{key:"dtr",value:function(e){return e*(Math.PI/180)}},{key:"drawCircle",value:function(e,t,n,r,o){e.save(),e.fillStyle=o,e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}}]),e}(),k=!1,M=!1,P=[],I=function(t,n){g=t.getContext("2d"),v=t.width,b=t.height,p=function(t,n,r,o,a,i){var c,l=t.createLinearGradient(0,0,0,a),u=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw i}}}}([{percent:0,color:"AliceBlue"},{percent:.25,color:"Aqua"},{percent:.5,color:"CornflowerBlue"},{percent:.75,color:"blue"},{percent:1,color:"black"}]);try{for(u.s();!(c=u.n()).done;){var s=c.value;l.addColorStop(s.percent,s.color)}}catch(e){u.e(e)}finally{u.f()}return l}(g,0,0,0,b),w=n,S=new Uint8Array(w.fftSize/2),(q=new Image).src="media/grovyle.png",q.onload=function(){g.drawImage(q,0,0,3.125*q.width,3.125*q.height),console.log(q.width,q.height),M=!0},P.push(new T(0,250,5,"red",249)),P.push(new A(167,64,137.7,1))},C=function(){k=!k},R={showGradient:!1,showBars:!0,showCircles:!1,showNoise:!1,showInvert:!1,showEmboss:!1},x=Object.freeze({sound1:"media/Dialga's Fight to the Finish.mp3"}),j=!1,E=!1,F=function(){var e=new XMLHttpRequest;e.onload=function(e){console.log("In onload - HTTP Status Code = ".concat(e.target.status));var t,n=e.target.responseText;try{t=JSON.parse(n)}catch(e){return console.log("ERROR: ".concat(e)),void(document.querySelector("#output").innterHTML="JSON ERROR")}R.showBars=t.uiState.showBars,t.uiState.treble&&(E=document.querySelector("#cb-highshelf").checked=t.uiState.treble,z()),t.uiState.bass&&(j=document.querySelector("#cb-lowshelf").checked=t.uiState.bass,D()),t.uiState.domainData&&(document.querySelector("#cb-timedomain").checked=t.uiState.domainData,C()),document.querySelector("#output").innerHTML="Track: ".concat(t.audio.name),document.querySelector("#title").innerHTML="".concat(t.Title)},e.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))},e.open("GET","data/av-data.json"),e.send()},B=function(e){var n=document.querySelector("#btn-fs"),r=document.querySelector("#btn-play"),a=document.querySelector("#cb-bars");document.querySelector("#cb-highshelf").checked=E,document.querySelector("#cb-lowshelf").checked=j,document.querySelector("#cb-highshelf").onchange=function(e){E=e.target.checked,z()},document.querySelector("#cb-lowshelf").onchange=function(e){j=e.target.checked,D()},z(),D(),document.querySelector("#cb-timedomain").onchange=function(e){C()},a.onchange=function(e){R.showBars=!R.showBars},n.onclick=function(t){var n;console.log("init called"),(n=e).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()},r.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume(),console.log("audioCtx.state after = ".concat(t.state)),"no"==e.target.dataset.playing?(o.play(),e.target.dataset.playing="yes"):(o.pause(),e.target.dataset.playing="no",t.suspend())};var i=document.querySelector("#slider-volume"),l=document.querySelector("#label-volume");i.oninput=function(e){var t;t=e.target.value,t=Number(t),c.gain.value=t,l.innerHTML=Math.round(e.target.value/2*100)},i.dispatchEvent(new Event("input"))},O=function e(){setTimeout(e,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0==k?w.getByteFrequencyData(S):w.getByteTimeDomainData(S),g.save(),g.fillStyle="black",g.globalAlpha=.1,1==M&&g.drawImage(q,0,0,3.125*q.width,3.125*q.height),g.restore(),P.forEach((function(e){e.update(),e.draw(g)})),e.showGradient&&(g.save(),g.fillStyle=p,g.globalAlpha=.3,g.fillRect(0,0,v,b),g.restore()),e.showBars){S.length,S.length,g.save(),g.fillStyle="red",g.translate(-10,250);var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}(S);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=r/255;o<.02&&(o=.15),g.translate(10,0),g.scale(1,-1),g.fillStyle="rgb(".concat(r,", ").concat(r-128,", ").concat(255-r,")"),g.fillRect(0,5,10,100*o),g.translate(0,0)}}catch(e){n.e(e)}finally{n.f()}g.restore()}if(e.showCircles){var a=b/4;g.save(),g.globalAlpha=.5;for(var i=0;i<S.length;i++){var c=S[i]/255,u=c*a;g.beginPath(),g.fillStyle=l(255,111,111,.34-c/3),g.arc(v/2,b/2,u,0,2*Math.PI,!1),g.fill(),g.closePath(),g.beginPath(),g.fillStyle=l(0,0,255,.1-c/10),g.arc(v/2,b/2,1.5*u,0,2*Math.PI,!1),g.fill(),g.closePath(),g.save(),g.beginPath(),g.fillStyle=l(200,200,0,.5-c/5),g.arc(v/2,b/2,.5*u,0,2*Math.PI,!1),g.closePath(),g.restore()}g.restore()}for(var s=g.getImageData(0,0,v,b),h=s.data,d=h.length,y=s.width,m=0;m<d;m+=4)if(e.showNoise&&Math.random()<.05&&(h[m]=h[m+1]=h[m+2]=0,h[m]=255,h[m+1]=255,h[m+2]=255),e.showInvert){var T=h[m],A=h[m+1],I=h[m+2];h[m]=255-T,h[m+1]=255-A,h[m+2]=255-I}if(e.showEmboss)for(var C=0;C<d;C++)C%4!=3&&(h[C]=127+2*h[C]-h[C+4]-h[C+4*y]);g.putImageData(s,0,0)}(R)};function z(){E?(n.frequency.setValueAtTime(1e3,t.currentTime),n.gain.setValueAtTime(10,t.currentTime)):n.gain.setValueAtTime(0,t.currentTime)}function D(){j?(r.frequency.setValueAtTime(1e3,t.currentTime),r.gain.setValueAtTime(10,t.currentTime)):r.gain.setValueAtTime(0,t.currentTime)}window.onload=function(){console.log("window.onload called"),function(){var e,l;F(),e=x.sound1,l=window.AudioContext||window.webkitAudioContext,t=new l,o=new Audio,s(e),a=t.createMediaElementSource(o),(n=t.createBiquadFilter()).type="highshelf",(r=t.createBiquadFilter()).type="lowshelf",(i=t.createAnalyser()).fftSize=u.numSamples,(c=t.createGain()).gain.value=u.gain,a.connect(n),n.connect(r),r.connect(i),i.connect(c),c.connect(t.destination);var f=document.querySelector("canvas");B(f),I(f,i),O()}()}})();